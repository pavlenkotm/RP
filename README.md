# Программа автоматической генерации расчётов на прочность

Программа предназначена для автоматического формирования документов "Расчёт на прочность" для детского игрового оборудования на основе данных из Excel, паспортов изделий (PDF) и шаблона Word.

## Структура проекта

```
strength_calc_generator/
├── main.py                          # Главный файл программы
├── requirements.txt                 # Зависимости Python
├── README.md                        # Документация
├── config/                          # Конфигурационные файлы
│   ├── config.json                 # Основная конфигурация
│   └── texts_by_category.json      # Тексты по категориям изделий
├── modules/                         # Модули программы
│   ├── config_manager.py           # Управление конфигурацией
│   ├── logger.py                   # Логирование
│   ├── excel_reader.py             # Чтение Excel
│   ├── pdf_parser.py               # Парсинг PDF паспортов
│   └── docx_generator.py           # Генерация Word документов
├── logs/                            # Логи работы программы
└── output/                          # Выходные документы (создаётся автоматически)
```

## Требования

### Системные требования
- Windows 10/11
- Python 3.8 или выше
- Microsoft Word (для обновления полей документа)

### Исходные данные
1. **Excel файл** с каталогом изделий:
   - Путь: `D:\Найденные_папки\каталог_картинок_с_нагрузкой.xlsx`
   - Столбцы: A (артикул), B (наименование), D (путь к картинке), E (количество детей)

2. **Паспорта изделий** (PDF):
   - Путь: `D:\Найденные_папки\Паспорта\`
   - Формат имени: должен содержать артикул изделия

3. **Шаблон Word**:
   - Путь: `D:\Найденные_папки\Пример расчетов.docx`

4. **Папка с ГОСТами**:
   - Путь: `D:\Найденные_папки\ГОСТ\`

## Установка

### 1. Установка Python
Скачайте и установите Python 3.8+ с официального сайта: https://www.python.org/downloads/

При установке обязательно отметьте "Add Python to PATH".

### 2. Установка зависимостей

Откройте командную строку (cmd) в папке с программой и выполните:

```bash
pip install -r requirements.txt
```

### 3. Настройка конфигурации

Отредактируйте файл `config/config.json`:

```json
{
  "paths": {
    "excel": "D:\\Найденные_папки\\каталог_картинок_с_нагрузкой.xlsx",
    "passports": "D:\\Найденные_папки\\Паспорта",
    "template_docx": "D:\\Найденные_папки\\Пример расчетов.docx",
    "output_docs": "D:\\Найденные_папки\\Расчеты на прочность",
    "gost": "D:\\Найденные_папки\\ГОСТ",
    "log_file": "D:\\Найденные_папки\\log_РП.txt"
  },
  "loads": {
    "mass_child": 53.8,
    "snow_load": {
      "S0": 180
    },
    "wind_load": {
      "W0": 32
    }
  }
}
```

Убедитесь, что все пути указаны правильно.

## Использование

### Запуск программы

Откройте командную строку в папке с программой и выполните:

```bash
python main.py
```

### Процесс работы

Программа автоматически:

1. Считывает данные из Excel файла
2. Для каждого изделия:
   - Находит паспорт по артикулу
   - Извлекает технические данные из паспорта
   - Проверяет наличие изображения
   - Генерирует документ Word на основе шаблона
   - Заполняет все данные (артикул, наименование, нагрузки, параметры)
   - Вставляет изображение
   - Обновляет поля документа (нумерация страниц, содержание)
   - Сохраняет документ в выходную папку

3. Формирует отчёт о результатах работы

### Выходные файлы

Документы сохраняются в папке, указанной в `config.json` → `paths.output_docs`:

Имя файла: `<артикул>_<наименование>_РП.docx`

Например: `01-005-0001-00_Песочница Периметр Р 180 390 200_РП.docx`

## Логирование

Программа ведёт подробный лог работы в файле, указанном в конфигурации (`log_file`).

Типы записей в логе:
- **OK** - документ успешно создан
- **ERR_NO_PASSPORT** - не найден паспорт изделия
- **ERR_NO_IMAGE** - не найдено изображение
- **ERR_PDF_PARSE** - ошибка чтения PDF
- **ERR_TEMPLATE** - ошибка работы с шаблоном
- **ERR_UNKNOWN** - прочие ошибки

## Обработка ошибок

Если при обработке изделия возникает ошибка, программа:
1. Записывает информацию об ошибке в лог
2. Продолжает обработку следующих изделий
3. В конце выводит итоговую статистику

## Категории изделий

Программа поддерживает следующие категории:
- Домики
- Игровые комплексы
- Игровые элементы
- Мини-беседки
- Беседки
- Песочницы

Категория определяется автоматически по наименованию изделия.

Тексты для каждой категории можно настроить в файле `config/texts_by_category.json`.

## Нагрузки

### Регион расчёта
Все расчёты выполняются для **г. Санкт-Петербург**.

### Параметры нагрузок
- **Масса ребёнка**: 53.8 кг (константа)
- **Снеговая нагрузка S₀**: 180 кг/м² (для СПб)
- **Ветровая нагрузка W₀**: 32 кг/м² (для СПб)

Значения можно изменить в `config.json` → `loads`.

## Особенности работы с шаблоном

Шаблон Word должен содержать:
- Плейсхолдеры вида `{НАЗВАНИЕ}` для автоматической подстановки данных
- Рамки и штампы по ЕСКД
- Структуру разделов расчёта
- Поля Word для нумерации страниц: `{ PAGE }` и `{ NUMPAGES }`

Основные плейсхолдеры:
- `{ARTICLE}` - артикул изделия
- `{NAME}` - наименование изделия
- `{REGION}` - регион расчёта
- `{CHILDREN_COUNT}` - количество детей
- `{TOTAL_MASS}` - общая масса детей
- `{SNOW_LOAD}` - снеговая нагрузка
- `{WIND_LOAD}` - ветровая нагрузка
- `{YEAR}` - текущий год

## Производительность

- Время обработки: ~1-3 секунды на одно изделие
- Поддержка обработки: до 300 изделий за один запуск
- Ориентировочное время для 300 изделий: 10-15 минут

## Решение проблем

### Ошибка "Модуль не найден"
```bash
pip install -r requirements.txt
```

### Ошибка "Excel файл не найден"
Проверьте путь в `config.json` → `paths.excel`

### Ошибка "Паспорт не найден"
Убедитесь, что:
1. Паспорты находятся в правильной папке
2. Имя файла паспорта содержит артикул изделия

### Не обновляются поля (PAGE, NUMPAGES)
Убедитесь, что установлен Microsoft Word. Программа использует COM для обновления полей.

### Ошибка "Permission denied" при сохранении
Закройте все открытые документы Word и повторите попытку.

## Техническая поддержка

При возникновении проблем:
1. Проверьте лог-файл (путь указан в конфигурации)
2. Убедитесь, что все пути в конфигурации указаны правильно
3. Проверьте наличие всех исходных данных

## Лицензия

Программа разработана для внутреннего использования организацией "ПромМашТест".

## Версия

Версия: 1.0.0  
Дата: 2025
